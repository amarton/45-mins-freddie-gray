var app={init:function(){app.download_data(),app.load_hash(),app.lightbox_events(),app.share_pic(),app.share()},download_data:function(){var t="SELECT 'rowid', 'caption', 'credit', 'src', 'location', 'twitpic', 'host' FROM 1evP7nWkOIWEkEDAzqTdZOxnNUhtwmbokDqCQ_VGA",i=encodeURIComponent(t),o=["https://www.googleapis.com/fusiontables/v1/query"];o.push("?sql="+i),o.push("&key=AIzaSyBdWG-uP6bBLhtl7Qq5b8wCHds2tCkuhrQ"),o.push("&callback=?"),$.ajax({url:o.join(""),dataType:"jsonp",success:function(t){var i=t.rows;for(var o in i){var a=Number(i[o][0]),e=i[o][1],n=i[o][2],r=i[o][3],s=i[o][4],p=i[o][5],c=i[o][6];app.pic_data.push({id:a,caption:e,credit:n,src:r,location:s,twitpic:p,host:c})}app.populate_photos()}})},populate_photos:function(){var t,i=$.grep(app.pic_data,function(t){return"baltimore"===t.location});for(var o in i)t="",t+='<div class="grid-item" data-id="'+i[o].id+'">',t+='<img class="" src="'+app.generate_piclink(i,o,600)+'" />',t+='<div class="overlay"></div><div class="expand"><span class="icon-expand"></span></div><div class="share-tools"><div class="group"><span class="icon-twitter2"></span><span class="icon-facebook2"></span></div>',t+='<div class="mobile-caption">'+i[o].caption+'<div class="mobile-credit">'+i[o].credit+"</div></div></div></div>",$("#baltimore").append(t);var a=$.grep(app.pic_data,function(t){return"national"===t.location});for(var o in a)t="",t+='<div class="grid-item" data-id="'+a[o].id+'">',t+='<img class="" src="'+app.generate_piclink(a,o,600)+'" />',t+='<div class="overlay"></div><div class="expand"><span class="icon-expand"></span></div><div class="share-tools"><div class="group"><span class="icon-twitter2"></span><span class="icon-facebook2"></span></div>',t+='<div class="mobile-caption">'+a[o].caption+'<div class="mobile-credit">'+a[o].credit+"</div></div></div></div>",$("#national").append(t)},fade_in_photos:function(){$("img").on("load",function(){$(this).addClass("visible")})},load_hash:function(){var t=location.hash.slice(1);app.test_hash(t)&&(app.place_lightbox(),app.open_lightbox(t))},test_hash:function(t){for(var i in app.pic_data)if(app.pic_data[i].id===Number(t))return!0;return!1},lightbox_events:function(){app.place_lightbox(),$("#grids").on("click",".grid-item .overlay",function(){var t=$(this).parent().data("id");app.open_lightbox(t),$("#lightbox-tools").attr("data-id",t)}),$("#grids").on("click",".grid-item .expand",function(){var t=$(this).parent().data("id");app.open_lightbox(t),$("#lightbox-tools").attr("data-id",t)}),$("#lightbox-content").on("click",".icon-arrow-down3",function(){app.toggle_lightbox_credit("close")}),$("#lightbox-content").on("click",".icon-arrow-up3",function(){app.toggle_lightbox_credit("open")}),$("#lightbox .icon-close").on("click",function(){app.close_lightbox()}),$("#lightbox-overlay").on("click",function(){app.close_lightbox()}),$("#close-lightbox-overlay").on("click",function(){app.close_lightbox()}),$(window).resize(function(){app.place_lightbox()})},place_lightbox:function(){window.innerHeight<850?$("#lightbox-img img").css("width",window.innerHeight-50+"px").css("height",window.innerHeight-50+"px"):$("#lightbox-img img").css("width","800px").css("height","800px");var t=$("#lightbox").height(),i=(window.innerHeight-t)/2;$("#lightbox").css("top",i+"px")},open_lightbox:function(t){$("#lightbox-overlay").addClass("visible"),$("#lightbox").addClass("visible"),$("body").addClass("frozen");var i=$.grep(app.pic_data,function(i){return i.id===Number(t)});$("#lightbox-img img").attr("src",app.generate_piclink(i,0,800)),$("#lightbox-credit-text").html(i[0].caption+"<span> ("+i[0].credit+") </span>"),$("#lightbox-tools a").attr("href","http://data.baltimoresun.com/valentines/images/valentines/800x800/"+t+".jpg")},close_lightbox:function(){$("#lightbox-overlay").removeClass("visible"),$("#lightbox").removeClass("visible"),setTimeout(function(){$("#lightbox-img img").attr("src","")},500),$("body").removeClass("frozen"),app.toggle_lightbox_credit("open")},toggle_lightbox_credit:function(t){"close"===t&&($("#lightbox-credit").addClass("hidden"),$("#lightbox-credit-toggle span").attr("class","icon-arrow-up3")),"open"===t&&($("#lightbox-credit").removeClass("hidden"),$("#lightbox-credit-toggle span").attr("class","icon-arrow-down3"))},tweet_item:function(t){var i=$.grep(app.pic_data,function(i){return i.id===Number(t)}),o="Check out signs from the Freddie Gray protests. "+i[0].twitpic,a="http://data.baltimoresun.com/freddie-gray/protest-signs/%23"+t,e="freddiegray",n="https://twitter.com/intent/tweet?text="+o+"&url="+a+"&tw_p=tweetbutton&hashtags="+e;return window.open(n,"mywin","left=200,top=200,width=500,height=300,toolbar=1,resizable=0"),!1},facebook_item:function(t){var i=$.grep(app.pic_data,function(i){return i.id===Number(t)}),o=app.generate_piclink(i,0,600),a="Signs of the Freddie Gray protests",e="Check out signs from the Baltimore and national protests inspired by Freddie Gray",n="http://data.baltimoresun.com/",r="https://www.facebook.com/dialog/feed?display=popup&app_id=310302989040998&link="+n+"&picture="+o+"&name="+a+"&description="+e+"&redirect_uri=http://www.facebook.com";return window.open(r,"mywin","left=200,top=200,width=500,height=300,toolbar=1,resizable=0"),!1},share_pic:function(){$("#lightbox-tools .icon-twitter2").on("click",function(){var t=$(this).parent().attr("data-id");app.tweet_item(t)}),$("#lightbox-tools .icon-facebook2").on("click",function(){var t=$(this).parent().attr("data-id");app.facebook_item(t)}),$("#grids").on("click",".share-tools .icon-twitter2",function(){var t=$(this).parent().parent().parent().attr("data-id");app.tweet_item(t)}),$("#grids").on("click",".share-tools .icon-facebook2",function(){var t=$(this).parent().parent().parent().attr("data-id");app.facebook_item(t)})},share:function(){$(".icon-twitter").on("click",function(){var t="Check out signs from the Baltimore and national protests inspired by Freddie Gray",i="http://data.baltimoresun.com/freddie-gray/protest-signs/",o="freddiegray",a="https://twitter.com/intent/tweet?text="+t+"&url="+i+"&tw_p=tweetbutton&hashtags="+o;return window.open(a,"mywin","left=200,top=200,width=500,height=300,toolbar=1,resizable=0"),!1}),$(".icon-facebook").on("click",function(){var t="http://data.baltimoresun.com/freddie-gray/protest-signs/images/600/justice.jpg",i="Signs of the Freddie Gray protests",o="Check out signs from the Baltimore and national protests inspired by Freddie Gray",a="http://data.baltimoresun.com/freddie-gray/protest-signs/",e="https://www.facebook.com/dialog/feed?display=popup&app_id=310302989040998&link="+a+"&picture="+t+"&name="+i+"&description="+o+"&redirect_uri=http://www.facebook.com";return window.open(e,"mywin","left=200,top=200,width=500,height=300,toolbar=1,resizable=0"),!1})},generate_piclink:function(t,i,o){return"data.baltimoresun.com"===t[i].host?"http://data.baltimoresun.com/freddie-gray/protest-signs/images/"+o+"/"+t[i].src:t[i].src+"/"+o+"/"+o+"x"+o},pic_data:[]};$(document).ready(function(){app.init()});